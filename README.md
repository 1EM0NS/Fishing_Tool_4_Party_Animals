# 🐻🎣 猛兽派对钓鱼助手 Fishing Tool for *Party Animals 2.0*  

![展示图片](github_dist/show.png)

这是一个专门针对 **《猛兽派对（Party Animals）》钓鱼模式** 的自动化辅助工具。  
新版程序基于 **Python + OpenCV + Tkinter**，通过屏幕截图识别 **鱼饵数字变化（灰度差分）与张力指针**，并模拟鼠标/键盘操作，实现 **自动抛竿、检测咬钩、收杆控制** 等功能。

---

## ⚡ 新版改进亮点

- **咬钩检测方式优化**  
  从模板匹配（感叹号提示）改为 **灰度差分检测** —— 监测鱼饵数字区域的像素变化，更快更稳定。  

- **收杆判定逻辑改进**  
  - 新增 **最大收杆时长**：超时直接判定失败并进入冷却。  
  - 指针丢失依旧判定为收杆成功。  
  - 区分 **失败冷却** 与 **成功冷却**，避免误触发。  

- **咬钩检测延迟**  
  - 收杆成功后有一段“冷却时间”不再检测。  
  - 抛竿完成后的一小段时间内也禁止判定咬钩。  

- **UI 增强**  
  - 支持实时展示 **鱼饵区域的差分数值**，帮助调节参数。  
  - 可手动框选指针区域与咬钩区域。  
  - 中文提示、参数输入框优化。  

---

## 🎥 视频演示

<div align="center">
  <video src="fishing.mp4" controls width="70%"></video>
  <p>如果视频无法播放，请<a href="github_dist/fishing.mp4" download>点击这里下载</a>。</p>
</div>

---

## ✨ 功能特点

<div align="center">
  <img src="github_dist/software.png" alt="软件界面" width="50%">
</div>

- **自动钓鱼循环**
  - 自动按住鼠标抛竿（支持末段自动按 `A` 校正角度）
  - 等待检测到鱼饵数字变化（灰度差分判定咬钩）
  - 自动收杆：实时监测指针角度和移动速度
  - 完成后自动进入下一轮钓鱼

- **咬钩检测**
  - 基于 **灰度差分算法**，监测鱼饵数字变化
  - 支持设定阈值与连续帧确认次数，提升准确度  


- **指针检测**
  - 基于 HSV 颜色掩膜（默认橙色阈值）
  - 模板匹配（支持旋转角度 ±40°）

- **可视化 UI**
  - Tkinter 界面展示指针检测画面 + 鱼饵区域
  - 参数输入框，所有策略参数可实时调整
  - 按钮与全局热键均可控制  

---

## ⚙️ 安装依赖

需要 **Python 3.9+**，然后安装依赖：

```bash
pip install opencv-python mss Pillow numpy pyautogui keyboard
```

---

## ▶️ 运行方式

运行脚本：

```bash
python fishing_tool.py
```

首次运行时：

- 默认指针区域：
  ```json
  {"top": 1010, "left": 1370, "width": 400, "height": 200}
  ```
- 默认咬钩区域：
  ```json
  {"top": 300, "left": 1400, "width": 300, "height": 300}
  ```

你可以在 UI 中点击 **“设置指针区域”** 或 **“设置咬钩区域”** 手动框选（回车键确认）。

---

## ⌨️ 全局快捷键

- **1** ：启动/停止 自动钓鱼循环  
- **3** ：立即停止（紧急中断）  

这些快捷键是全局的，不需要切换到程序窗口。

---

## ⚙ 程序参数说明

在 UI 界面中可以调节以下参数：

### 抛竿前
- `cast_hold_time`：抛竿时长，默认 `3.0`  
- `post_cast_wait`：抛竿后等待，默认 `0.5`  
- `cast_adjust_a_time`：末段按 A 的时长，默认 `0.25`  

### 等上钩时
- `max_bite_wait`：最长等待时间，默认 `30`  
- `bite_diff_threshold`：像素均值差阈值，默认 `5`  
- `bite_confirm_frames`：连续帧确认次数，默认 `1`  

### 收杆时
- `pointer_loss_time`：指针丢失判定时间，默认 `0.2`  
- `release_angle`：松开角度阈值，默认 `60`  
- `release_speed`：松开速度阈值，默认 `8`  
- `max_reel_time`：最大收杆时长，默认 `29`  
- `post_fail_cooldown`：失败冷却时间，默认 `4.0`  

### 收杆后
- `reel_end_wait`：收杆结束等待，默认 `1.8`  
- `short_press_time`：短按左键时长，默认 `0.2`  
- `next_cast_sleep`：下一轮间隔，默认 `2.0`  
- `bite_rearm_delay`：收杆成功后禁止检测时间，默认 `4.0`  
- `bite_arm_after_cast_delay`：抛竿完成后禁止检测时间，默认 `4.0`  

---

## ❓ 常见问题

1. **程序没有检测到指针怎么办？**  
   - 请确认 `pointer_template.png` 是否正确截图。  
   - 重新设置指针区域，并调整 HSV 参数。  

2. **咬钩检测总是失败？**  
   - 请用“设置咬钩区域”选择鱼饵数字区域。  
   - 调整 `bite_diff_threshold` 和 `bite_confirm_frames`。

3. **程序卡顿或响应慢？**  
   - 减少检测区域大小。  
   - 调整 `FRAME_INTERVAL_MS`。  

---

## 📜 开源说明

本项目以 **MIT License** 开源，欢迎学习、修改与分享。  
请勿将本工具用于违反游戏规则的场景。  
